generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Role constants: ADMIN, TEACHER, PARENT
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("PARENT")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  teacherProfile TeacherProfile?
  parentProfile  ParentProfile?
}

model TeacherProfile {
  id      String @id @default(cuid())
  userId  String @unique
  user    User   @relation(fields: [userId], references: [id])
  
  classes Class[]
  active  Boolean @default(true)
}

model ParentProfile {
  id           String         @id @default(cuid())
  userId       String         @unique
  user         User           @relation(fields: [userId], references: [id])
  
  phone        String?
  relationship String?
  
  students     ParentStudent[]
}

model Student {
  id        String   @id @default(cuid())
  name      String
  birthDate DateTime
  
  parents   ParentStudent[]
  
  enrollments ClassEnrollment[]
  grades      Grade[]
  active      Boolean @default(true)
}

model ParentStudent {
  parentId  String
  parent    ParentProfile @relation(fields: [parentId], references: [id])
  studentId String
  student   Student       @relation(fields: [studentId], references: [id])
  
  @@id([parentId, studentId])
}

model Class {
  id        String   @id @default(cuid())
  name      String
  teacherId String
  teacher   TeacherProfile @relation(fields: [teacherId], references: [id])
  
  location  String?
  schedule  String?

  students  ClassEnrollment[]
  grades    Grade[]
  active    Boolean @default(true)
}

model ClassEnrollment {
  id        String @id @default(cuid())
  studentId String
  student   Student @relation(fields: [studentId], references: [id])
  classId   String
  class     Class   @relation(fields: [classId], references: [id])

  @@unique([studentId, classId])
}

model Grade {
  id        String   @id @default(cuid())
  value     Float
  subject   String? 
  description String?
  type        String?  // EVALUACION, QUIZ, TRABAJO
  period    Int      @default(1)
  date      DateTime @default(now())
  
  studentId String
  student   Student @relation(fields: [studentId], references: [id])
  classId   String
  class     Class   @relation(fields: [classId], references: [id])
}
